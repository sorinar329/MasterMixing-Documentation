\section{Implementation in PyCram}

\subsection{Robots Plan Execution}
The robots plan used for implementing the MixingActionDesignator and its evaluation is 
a simple plan, including the following steps:

\begin{itemize}
    \item Park Arms
    \item Elevate the robots torso
    \item Navigate to the tool used for mixing
    \item Pick up tool
    \item Park arms
    \item Move to kitchen counter
    \item Look at the container to mix the ingredients
    \item Mix ingredients
\end{itemize}

In the following subsections we will explain, how the robot uses its knowledge during task execution, 
to mix. 

\subsection{Asserted Knowledge}
Any robot capable of executing mixing motions need to have knowledge before executing a mixing task. 
The robot needs to know where the container and tools are located, for picking up and for navigation to Theoretically
respective places. It needs to know which ingredients have to be mixed, in simulation only their existence have to be known. 
It needs to know which task to execute, since we differentiate between different mixing tasks as discussed in this section. 


\subsection{Inferring Knowledge}
As of now, the robot doesn't know what kind of mixing motion it has to perform. Its associated parameters are also unknown. 
Therefore, the robot needs to reason about its assertional knowledge.
Once it has access to all relevant information, it can infer the appropriate mixing motion or motions, in case a compound motion has been
inferred, with its corresponding parameters through logical reasoning.
Logical reasoning is performed inside the custom resolver \textit{MixingActionSWRL}.

\subsection{MixingActionSWRL}
\label{subsection:MixingActionSWRL}
\textit{MixingActionSWRL} is a custom resolver using our \textit{mixing} ontology to infer motions from the robots assertional knowledge.
The resolvers task is to fill the missing descriptions of which motions should be executed with its associated parameters.

\paragraph{Initialization}
The resolver loads the mixing ontology, initializes the task to execute and initializes all ingredients which are being mixed. 
All names need to be available for later instantiation.
The high level class \textit{Motion} is instantiated, representing the individual of all possible motions. 
The resolver attempts to reclassify this motion into a specific one that will be executed on the robot.

First container, tool and ingredients are instantiated, additionally a task instance is created and its relations with 
the other individuals are assigned. To find the proper corresponding class, to the names of the container, ingredients, task and tool
we perform fuzzy string matching to find a matching class to the name. 

\paragraph{Fuzzy String Matching}
Using the levenshtein distance, syntactic similarity of two different strings is computed. A low distance score
indicates a higher similarity than a high score. However, this metric does not account for semantic similarities, 
as the words meanings are not considered in the computation of distance.

\paragraph{Inference}
Once the relations have been assigned, using \textit{OWLReady} with builtin functions calling reasoners like \textit{Pellet} or \textit{HermIt},
reclassifies the motion instance using the defined \textit{SWRL} rules inside the \textit{mixing} ontology.
Since the individual instantiated from the class \textit{Motion} has been reclassified the motion parameters can be extracted from the class.

Finally, the resolver completes the sequence of motions to be executed with its associated parameters and 
forwards it to the MixingAction.

\subsection{MixingActionDesignator}
The \textit{MixingActionDesignator} is a action designator 
designed to perform various types of mixing motions or sequences of motions within a specific container using a specific tool. 
This designator generates poses that follow a trajectory, simulating the process of mixing in the bulletworld environment.
To effectively break down the action into executable motions, certain designator descriptions are required.


\paragraph{Designator Description}
\begin{enumerate}
    \item \textit{Container Object Designator}:
    \begin{itemize}
        \item This object designator contains information about its name and its bulletword internal represnation.
            Its bulletworld representations holds information like the current objects pose and its 3D axis aligned bounding box.
            This bounding box can be used to compute the dimensions of the container along each axis. 
            Knowing the bounds and the pose of the container is crucial, because the motion has to performed inside 
            the container within its boundaries.
    \end{itemize}
    \item \textit{Tool Object Designator}:
    \begin{itemize}
        \item Analogous to the container this designator contains the same type of information.
        Knowing the dimensions of the tool is crucial in avoiding collision with the container.
    \end{itemize}
    \item \textit{Arm}:
    \begin{itemize}
        \item Which arm should be used to perform the mixing action
    \end{itemize}
    \item \textit{Motions}:
    \begin{itemize}
        \item A list of motions as strings to be performed. 
    \end{itemize}
    \item \textit{Motion Parameters}:
    \begin{itemize}
        \item Each motion has its own key value pairs of parameters.
        These parameters alongside the motion are resolved by the \nameref*{subsection:MixingActionSWRL}
    \end{itemize}
\end{enumerate}

\paragraph*{Resolving motion and parameters}
The \textit{MixingActionDesignator} calls the \textit{MixingActionSWRL} resolver, to infer the motion with its 
associated parameters. 

\paragraph*{Sequential Processing in MixingActionDesignator}
Once all descriptions are available for the \textit{MixingActionDesignator}, it attempts the following steps in sequence:

\begin{enumerate}
    \item \textbf{Retrieve BulletWorld Objects}: The BulletWorld objects for both the container and the tool are retrieved from the object designator. 
    Each BulletWorld object has a 3D axis-aligned bounding box. Using this bounding box, the dimensions can be computed. 
    The implemented function \textit{get\_object\_dimensions()} returns the three dimensions of each BulletWorld object.
    \item \textbf{Motions}: Access the motion names and find out which motion has to be executed.
    \item \textbf{Calculate Radius Bounds}: The upper and lower radius bounds, which are relative values, 
    are accessed to compute the absolute radius for the respective mixing motion, using the dimensions of container and tool, to ensure
    that any mixing motion is executed inside the container.
    \item \textbf{Transform Container Pose}: The container's pose is retrieved and transformed into its own coordinate frame from the world coordinate frame to 
    compute mixing poses fitted to the container in its coordinate frame.
    \item \textbf{Generate Motion Trajectory}: Based on the current motion, 3D coordinates are generated using the functions defined in the section \nameref{sec:Motions},
    the values inside the motion parameters list are used for computation.
    \item \textbf{MoveTCP}: For each generated pose, that pose is elevated by a constant value and the execution of motion is done with MoveTCP, which 
    moves the tool center point of the robots arm.
    
\end{enumerate}
\paragraph*{Failure Handling}
The MixingAction lacks error handling implementation. It was primarily developed for simulation in a vacuum, where no ingredients are actually mixed
and some physical laws regarding ingredient interaction do not apply. As soon as the robot collides with the container in any way, 
causing the ingredients or the mixture to spill, 
the mixing process fails accordingly. 
